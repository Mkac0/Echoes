{% extends "base.html" %}
{% load humanize %}
{% block content %}

<h1>My Profile</h1>
<div class="card profile-card">
    <div class="profile-header">
        {% if object.avatar %}
            <img src="{{ object.avatar.url }}" alt="Avatar" class="profile-avatar">
        {% else %}
            <div class="profile-avatar placeholder">ðŸ‘¤</div>
        {% endif %}
        <div class="profile-info">
            <h2>{{ object.name|default:request.user.username }}</h2>
            {% if object.dealership_name %}
                <p class="dealership">{{ object.dealership_name }}</p>
            {% endif %}
        </div>
    </div>
    <div class="profile-body">
        {% if object.bio %}
            <p class="bio">{{ object.bio|linebreaksbr }}</p>
        {% else %}
            <p class="no-bio">No bio added yet.</p>
        {% endif %}
        <hr>
        <p class="meta"><strong>Account:</strong> {{ request.user.first_name }} {{ request.user.last_name }} â€” {{ request.user.email }}</p>
    </div>
</div>
<hr class="divider">
<section class="cards">
    {% for car in cars %}
        <a href="{% url 'car-detail' car.pk %}" class="card card-link">
            <div class="card-image-container">
                {% if car.photos.first %}
                    <img
                        src="{{ car.photos.first.image.url }}"
                        class="card-car-img"
                        data-photo-urls="{% for photo in car.photos.all %}{{ photo.image.url }}{% if not forloop.last %}|{% endif %}{% endfor %}"
                        data-current-index="0"
                        alt="{{ car.year }} {{ car.make }} {{ car.model }}"
                    >
                {% else %}
                    <div class="no-images-placeholder">No images yet</div>
                {% endif %}

                <button class="card-back-btn" type="button">&#x2039;</button>
                <button class="card-next-btn" type="button">&#x203A;</button>
            </div>

            <h3>{{ car.year }} {{ car.make }} {{ car.model }}</h3>
            <p class="meta">
                VIN: <strong>{{ car.vin }}</strong> &nbsp;&bull;&nbsp;
                ${{ car.price|floatformat:2|intcomma|default:"N/A" }} &nbsp;&bull;&nbsp;
                ${{ car.cash_down|floatformat:2|intcomma|default:"N/A" }} cash down
                <span class="status-{{ car.status }}">{{ car.get_status_display }}</span>
            </p>
        </a>
    {% empty %}
        <p class="meta">No cars yet.</p>
    {% endfor %}
</section>
{% if request.user == object.user %}
    <div class="action-links">
        <a href="{% url 'profile-edit' %}" class="btn btn-primary">Edit Profile</a>
    </div>
{% endif %}

{% endblock %}
